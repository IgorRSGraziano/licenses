<p style="color: green"><%= notice %></p>

<div class="flex justify-between items-center">
  <h1>Licenses</h1>
  <div>
    <%= link_to "Import", licenses_import_path, class: "button" %>
    <%= link_to "Generate", licenses_path, data: { turbo_method: "post" }, class: "button" %>
  </div>
</div>

<div id="licenses">
  <table class="border-collapse table-fixed w-full text-sm">
    <thead class="bg-slate-100 shadow-md">
    <tr>
      <% ['Key', 'Created At', 'Updated At', 'Customer', 'Status', 'Actions'].each do |text, index| %>
        <th class="border-b dark:border-slate-600 break-words font-medium text-center p-1 pt-6 py-3 text-slate-400 dark:text-slate-200 text-left">
          <%= text %>
        </th>
      <% end %>
    </tr>
    </thead>
    <tbody class="bg-white dark:bg-slate-800">
    <% @licenses.each do |license| %>
      <tr>
        <% [license.key, license.created_at, license.updated_at, license.customer&.email].each do |data| %>
          <td class="border-b border-slate-100 break-words dark:border-slate-700 p-4 px-1 m-auto text-center text-slate-500 dark:text-slate-400]"><%= data %></td>
        <% end %>
        <% #Show license background according to color
           if license.status == "active"
             bg = "bg-green-200"
           elsif license.status == "inactive"
             bg = "bg-red-200"
           else
             bg = "bg-blue-200"
           end
        %>
        <td class="border-b border-slate-100 break-words dark:border-slate-700 p-4 px-1 m-auto text-center text-slate-500 dark:text-slate-400">
          <span class="<%= bg %> block w-24 py-1 px-2 m-auto rounded hover:cursor-pointer" onclick="updateStatus(<%= license.id %>)">
          <%= license.status %>
          </span>
        </td>
        <td class="border-b border-slate-100 break-words dark:border-slate-700 p-4 px-1 m-auto text-center text-slate-500 dark:text-slate-400 w-0.5">
          <%= link_to "View", license_path(license), class: "button" %>
        </td>
      </tr>
    <% end %>
    </table>
</div>

<%= link_to "New license", new_license_path, class: "block text-right pt-6 mr-3 font-bold underline" %>

<%= paginate @licenses %>

<%=
  #TODO Remover isso e passar para o turbo
%>
<script>
    async function updateStatus(id) {
        const data = new FormData()
        data.append("id", id)
        await fetch("/licenses/change_status", {
            method: "PUT",
            headers: {
                "X-CSRF-Token": document.querySelector('meta[name="csrf-token"]').content,
            },
            body: data
        })
        window.location.reload() //FIXME
    }
</script>
